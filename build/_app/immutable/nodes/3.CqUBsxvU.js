var Ge=Object.defineProperty;var Te=a=>{throw TypeError(a)};var Fe=(a,e,t)=>e in a?Ge(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var j=(a,e,t)=>Fe(a,typeof e!="symbol"?e+"":e,t),Je=(a,e,t)=>e.has(a)||Te("Cannot "+t);var Re=(a,e,t)=>e.has(a)?Te("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t);var Oe=(a,e,t)=>(Je(a,e,"access private method"),t);import{m as _e,s as x,r as Xe,d as me,u as Ye}from"../chunks/index.CIpKNDaa.js";import{s as re,y as G,n as V,c as Y,z as pe,o as Ne,A as He,d as $,r as Pe,f as We}from"../chunks/scheduler.CHVDA16w.js";import{S as ne,i as oe,e as y,s as B,t as Q,c as I,a as O,f as L,b as Z,d as g,n as i,g as C,h,j as ie,m as ge,o as ee,y as te,z as se,A as ae,p as Ue,q as Ke,k as z,l as H,u as ye,B as le,C as Ae,w as Ie}from"../chunks/index.DIjhlOJV.js";import{N as Qe}from"../chunks/Navbar.CvsIK0wP.js";import{g as Ze}from"../chunks/entry.CH1JKiXr.js";function he(a){return(a==null?void 0:a.length)!==void 0?a:Array.from(a)}function xe(){let a,e;if(_e.subscribe(t=>a=t),x.subscribe(t=>e=t),!a||!e)throw Xe(307,"/")}const kt=Object.freeze(Object.defineProperty({__proto__:null,load:xe},Symbol.toStringTag,{value:"Module"}));function Me(a){let e;return{c(){e=y("i"),this.h()},l(t){e=I(t,"I",{class:!0}),O(e).forEach(g),this.h()},h(){i(e,"class","fa-solid fa-circle-user svelte-42ha35")},m(t,s){C(t,e,s)},d(t){t&&g(e)}}}function $e(a){let e,t;return{c(){e=y("img"),this.h()},l(s){e=I(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){i(e,"class","typeImg svelte-42ha35"),pe(e.src,t=a[0].body)||i(e,"src",t),i(e,"alt","Imagen subida Por un usuario")},m(s,l){C(s,e,l)},p(s,l){l&1&&!pe(e.src,t=s[0].body)&&i(e,"src",t)},d(s){s&&g(e)}}}function et(a){let e,t;return{c(){e=y("audio"),this.h()},l(s){e=I(s,"AUDIO",{src:!0}),O(e).forEach(g),this.h()},h(){pe(e.src,t=a[0].body)||i(e,"src",t),e.controls=!0},m(s,l){C(s,e,l)},p(s,l){l&1&&!pe(e.src,t=s[0].body)&&i(e,"src",t)},d(s){s&&g(e)}}}function tt(a){let e,t=a[0].body+"",s;return{c(){e=y("p"),s=Q(t),this.h()},l(l){e=I(l,"P",{class:!0});var r=O(e);s=Z(r,t),r.forEach(g),this.h()},h(){i(e,"class","montserrat-alternates-regular")},m(l,r){C(l,e,r),h(e,s)},p(l,r){r&1&&t!==(t=l[0].body+"")&&ie(s,t)},d(l){l&&g(e)}}}function st(a){let e,t,s,l,r=decodeURI(a[0].username)+"",n,E,c,k,m,p=a[0].type!==a[2].BOT&&Me();function R(u,v){if(u[0].type===u[2].ROOM||u[0].type===u[2].BOT)return tt;if(u[0].type===u[2].AUDIO)return et;if(u[0].type===u[2].IMAGE)return $e}let A=R(a),T=A&&A(a);return{c(){e=y("article"),t=y("div"),p&&p.c(),s=B(),l=y("h4"),n=Q(r),E=B(),c=y("div"),T&&T.c(),this.h()},l(u){e=I(u,"ARTICLE",{class:!0});var v=O(e);t=I(v,"DIV",{class:!0});var d=O(t);p&&p.l(d),s=L(d),l=I(d,"H4",{class:!0});var _=O(l);n=Z(_,r),_.forEach(g),d.forEach(g),E=L(v),c=I(v,"DIV",{class:!0});var U=O(c);T&&T.l(U),U.forEach(g),v.forEach(g),this.h()},h(){i(l,"class","montserrat-alternates-bold svelte-42ha35"),i(t,"class","username svelte-42ha35"),i(c,"class",k=G(`body ${a[0].type===a[2].BOT?"typeBot":a[0].type===a[2].AUDIO?"typeAudio":""}`)+" svelte-42ha35"),i(e,"class",m=G(a[1].username===decodeURI(a[0].username)?"me":"")+" svelte-42ha35")},m(u,v){C(u,e,v),h(e,t),p&&p.m(t,null),h(t,s),h(t,l),h(l,n),h(e,E),h(e,c),T&&T.m(c,null)},p(u,[v]){u[0].type!==u[2].BOT?p||(p=Me(),p.c(),p.m(t,s)):p&&(p.d(1),p=null),v&1&&r!==(r=decodeURI(u[0].username)+"")&&ie(n,r),A===(A=R(u))&&T?T.p(u,v):(T&&T.d(1),T=A&&A(u),T&&(T.c(),T.m(c,null))),v&1&&k!==(k=G(`body ${u[0].type===u[2].BOT?"typeBot":u[0].type===u[2].AUDIO?"typeAudio":""}`)+" svelte-42ha35")&&i(c,"class",k),v&3&&m!==(m=G(u[1].username===decodeURI(u[0].username)?"me":"")+" svelte-42ha35")&&i(e,"class",m)},i:V,o:V,d(u){u&&g(e),p&&p.d(),T&&T.d()}}}function at(a,e,t){let s;Y(a,_e,n=>t(1,s=n));var l=(n=>(n.ROOM="room",n.BOT="bot",n.AUDIO="audio",n.IMAGE="image",n.YT="yt",n))(l||{});let{data:r}=e;return a.$$set=n=>{"data"in n&&t(0,r=n.data)},[r,s,l]}class lt extends ne{constructor(e){super(),oe(this,e,at,st,re,{data:0})}}function rt(a){let e,t,s,l,r=decodeURI(a[1].username)+"",n,E,c;return{c(){e=y("article"),t=y("i"),s=B(),l=y("h4"),n=Q(r),E=B(),c=y("i"),this.h()},l(k){e=I(k,"ARTICLE",{"data-id":!0,class:!0});var m=O(e);t=I(m,"I",{class:!0}),O(t).forEach(g),s=L(m),l=I(m,"H4",{class:!0});var p=O(l);n=Z(p,r),p.forEach(g),E=L(m),c=I(m,"I",{class:!0}),O(c).forEach(g),m.forEach(g),this.h()},h(){i(t,"class","fa-solid fa-circle-user svelte-vv2xs7"),i(l,"class","montserrat-alternates-bold svelte-vv2xs7"),i(c,"class","fa-solid fa-circle-question svelte-vv2xs7"),i(e,"data-id",a[0]),i(e,"class","svelte-vv2xs7")},m(k,m){C(k,e,m),h(e,t),h(e,s),h(e,l),h(l,n),h(e,E),h(e,c)},p(k,[m]){m&2&&r!==(r=decodeURI(k[1].username)+"")&&ie(n,r),m&1&&i(e,"data-id",k[0])},i:V,o:V,d(k){k&&g(e)}}}function nt(a,e,t){let{id:s}=e,{data:l}=e;return a.$$set=r=>{"id"in r&&t(0,s=r.id),"data"in r&&t(1,l=r.data)},[s,l]}class ot extends ne{constructor(e){super(),oe(this,e,nt,rt,re,{id:0,data:1})}}function it(a){let e,t,s,l;return{c(){e=y("section"),t=y("article"),s=y("h4"),l=Q(a[0]),this.h()},l(r){e=I(r,"SECTION",{class:!0});var n=O(e);t=I(n,"ARTICLE",{class:!0});var E=O(t);s=I(E,"H4",{class:!0});var c=O(s);l=Z(c,a[0]),c.forEach(g),E.forEach(g),n.forEach(g),this.h()},h(){i(s,"class","montserrat-alternates-medium svelte-1b74fp1"),i(t,"class","svelte-1b74fp1"),i(e,"class","svelte-1b74fp1")},m(r,n){C(r,e,n),h(e,t),h(t,s),h(s,l)},p(r,[n]){n&1&&ie(l,r[0])},i:V,o:V,d(r){r&&g(e)}}}function ct(a,e,t){let s;Y(a,me,n=>t(2,s=n));let{msg:l}=e,{time:r}=e;return Ne(()=>{document.onkeydown=()=>!1}),He(()=>{document.onkeydown=null}),setTimeout(()=>$(me,s=!1,s),r),a.$$set=n=>{"msg"in n&&t(0,l=n.msg),"time"in n&&t(1,r=n.time)},[l,r]}class ut extends ne{constructor(e){super(),oe(this,e,ct,it,re,{msg:0,time:1})}}function we(a){let e,t='<i class="fa-solid fa-stop svelte-1in8yok"></i>',s,l;return{c(){e=y("button"),e.innerHTML=t,this.h()},l(r){e=I(r,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(e)!=="svelte-1lqnh5p"&&(e.innerHTML=t),this.h()},h(){i(e,"class","svelte-1in8yok")},m(r,n){C(r,e,n),s||(l=ee(e,"click",a[4]),s=!0)},p:V,d(r){r&&g(e),s=!1,l()}}}function ft(a){let e,t,s='<button class="montserrat-alternates-bold svelte-1in8yok">T</button>',l,r,n,E,c,k='<i class="fa-solid fa-image svelte-1in8yok"></i>',m,p,R,A,T,u,v,d,_=a[0]&&we(a);return{c(){e=y("div"),t=y("div"),t.innerHTML=s,l=B(),r=y("div"),n=y("input"),E=B(),c=y("label"),c.innerHTML=k,m=B(),p=y("div"),R=y("button"),A=y("i"),u=B(),_&&_.c(),this.h()},l(U){e=I(U,"DIV",{class:!0});var S=O(e);t=I(S,"DIV",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-j39qlt"&&(t.innerHTML=s),l=L(S),r=I(S,"DIV",{class:!0});var N=O(r);n=I(N,"INPUT",{type:!0,accept:!0,id:!0}),E=L(N),c=I(N,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ge(c)!=="svelte-dbs90"&&(c.innerHTML=k),N.forEach(g),m=L(S),p=I(S,"DIV",{class:!0});var W=O(p);R=I(W,"BUTTON",{class:!0});var P=O(R);A=I(P,"I",{class:!0}),O(A).forEach(g),P.forEach(g),W.forEach(g),u=L(S),_&&_.l(S),S.forEach(g),this.h()},h(){i(t,"class","txtStyle svelte-1in8yok"),i(n,"type","file"),i(n,"accept","image/*"),n.hidden=!0,i(n,"id","upImg"),i(c,"for","upImg"),i(c,"class","svelte-1in8yok"),i(r,"class","sendImg"),i(A,"class",T=G(`fa-solid fa-microphone ${a[1]}`)+" svelte-1in8yok"),R.disabled=a[2].audioState,i(R,"class","svelte-1in8yok"),i(p,"class","sendAudio"),i(e,"class","tools svelte-1in8yok")},m(U,S){C(U,e,S),h(e,t),h(e,l),h(e,r),h(r,n),h(r,E),h(r,c),h(e,m),h(e,p),h(p,R),h(R,A),h(e,u),_&&_.m(e,null),v||(d=[ee(n,"change",a[5]),ee(R,"click",a[3])],v=!0)},p(U,[S]){S&2&&T!==(T=G(`fa-solid fa-microphone ${U[1]}`)+" svelte-1in8yok")&&i(A,"class",T),U[0]?_?_.p(U,S):(_=we(U),_.c(),_.m(e,null)):_&&(_.d(1),_=null)},i:V,o:V,d(U){U&&g(e),_&&_.d(),v=!1,Pe(d)}}}const Se="https://frensgo.lat";function dt(a,e,t){var A,Ve;let s;Y(a,_e,u=>t(8,s=u));let{cbAudio:l}=e,{cbImage:r}=e;class n{constructor(){Re(this,A);j(this,"constraints");j(this,"chunks");j(this,"mediaRecorder");j(this,"audioURL");j(this,"audioState",!0);j(this,"state");j(this,"timeOut");navigator.mediaDevices&&(this.constraints={audio:!0},this.chunks=[],this.audioState=!1)}getDevices(){navigator.mediaDevices.getUserMedia(this.constraints).then(v=>{this.mediaRecorder=new MediaRecorder(v),this.mediaRecorder.ondataavailable=d=>{this.chunks.push(d.data)},this.mediaRecorder.onstop=async d=>{if(!this.state){this.chunks=[];return}const _=new Blob(this.chunks,{type:"audio/ogg;codecs=opus"});this.chunks=[];const U=await Oe(this,A,Ve).call(this,_);l({username:s.username,body:U,type:"audio"})}})}start(){return this.mediaRecorder&&(this.mediaRecorder.state==="inactive"||this.mediaRecorder.state==="paused")?(this.mediaRecorder.start(),this.timeOut=setTimeout(()=>{var v;return(v=this.mediaRecorder)==null?void 0:v.stop()},18e4),!0):!1}stop(v){return this.mediaRecorder&&this.mediaRecorder.state==="recording"?(clearTimeout(this.timeOut),this.state=v,this.mediaRecorder.stop(),!1):!0}}A=new WeakSet,Ve=async function(v){const d=new FormData;return d.append("audio",v),await(await fetch(`${Se}/audio`,{method:"POST",body:d})).text()};const E=new n;E.getDevices();let c=!1,k="stop";function m(){c?(t(0,c=E.stop(!0)),t(1,k="stop")):(t(0,c=E.start()),t(1,k="rec"))}function p(){t(0,c=E.stop(!1)),t(1,k="stop")}async function R(u){const v=u.target.files[0];if(v.size>5e6){alert("La imágen es muy pesada");return}if(!/^image\/....?$/.test(v.type)){alert("Por favor elija una imágen válida");return}const d=new FormData;d.append("image",v);const U=await(await fetch(`${Se}/upImg`,{method:"POST",body:d})).text();r({username:s.username,body:U,type:"image"})}return a.$$set=u=>{"cbAudio"in u&&t(6,l=u.cbAudio),"cbImage"in u&&t(7,r=u.cbImage)},[c,k,E,m,p,R,l,r]}class ht extends ne{constructor(e){super(),oe(this,e,dt,ft,re,{cbAudio:6,cbImage:7})}}function De(a,e,t){const s=a.slice();return s[15]=e[t][0],s[16]=e[t][1],s}function Be(a,e,t){const s=a.slice();return s[19]=e[t],s}function Le(a){let e,t;return e=new ut({props:{msg:"Aver si nos calmamos un poquito :)",time:5e3}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){H(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function ze(a){let e,t;return e=new lt({props:{data:a[19]}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},p(s,l){const r={};l&8&&(r.data=s[19]),e.$set(r)},i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){H(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Ce(a){let e,t;return e=new ot({props:{id:a[15],data:a[16]}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},p(s,l){const r={};l&4&&(r.id=s[15]),l&4&&(r.data=s[16]),e.$set(r)},i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){H(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function mt(a){let e,t,s,l,r,n,E,c,k,m,p,R,A,T,u='<i class="fa-solid fa-paper-plane svelte-8zx99x"></i>',v,d,_,U,S=a[2].size+"",N,W,P,ce,K,ve,Ee,D=a[4]&&Le();t=new Qe({});let F=he(a[3]),M=[];for(let o=0;o<F.length;o+=1)M[o]=ze(Be(a,F,o));const qe=o=>H(M[o],1,1,()=>{M[o]=null});k=new ht({props:{cbAudio:a[6],cbImage:a[7]}});let J=he(a[2].entries()),w=[];for(let o=0;o<J.length;o+=1)w[o]=Ce(De(a,J,o));const je=o=>H(w[o],1,1,()=>{w[o]=null});return{c(){D&&D.c(),e=B(),te(t.$$.fragment),s=B(),l=y("section"),r=y("article"),n=y("div");for(let o=0;o<M.length;o+=1)M[o].c();E=B(),c=y("div"),te(k.$$.fragment),m=B(),p=y("form"),R=y("input"),A=B(),T=y("button"),T.innerHTML=u,v=B(),d=y("article"),_=y("h3"),U=Q("Usuarios conectados: "),N=Q(S),W=B(),P=y("div");for(let o=0;o<w.length;o+=1)w[o].c();this.h()},l(o){D&&D.l(o),e=L(o),se(t.$$.fragment,o),s=L(o),l=I(o,"SECTION",{class:!0});var b=O(l);r=I(b,"ARTICLE",{class:!0});var f=O(r);n=I(f,"DIV",{class:!0});var q=O(n);for(let X=0;X<M.length;X+=1)M[X].l(q);q.forEach(g),E=L(f),c=I(f,"DIV",{class:!0});var ue=O(c);se(k.$$.fragment,ue),m=L(ue),p=I(ue,"FORM",{class:!0});var fe=O(p);R=I(fe,"INPUT",{class:!0,type:!0,placeholder:!0,maxlength:!0,minlength:!0}),A=L(fe),T=I(fe,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(T)!=="svelte-1m1u804"&&(T.innerHTML=u),fe.forEach(g),ue.forEach(g),f.forEach(g),v=L(b),d=I(b,"ARTICLE",{class:!0});var de=O(d);_=I(de,"H3",{class:!0});var be=O(_);U=Z(be,"Usuarios conectados: "),N=Z(be,S),be.forEach(g),W=L(de),P=I(de,"DIV",{class:!0});var ke=O(P);for(let X=0;X<w.length;X+=1)w[X].l(ke);ke.forEach(g),de.forEach(g),b.forEach(g),this.h()},h(){i(n,"class","chat svelte-8zx99x"),i(R,"class","montserrat-alternates-regular svelte-8zx99x"),i(R,"type","text"),i(R,"placeholder","Escribe tu mensaje..."),i(R,"maxlength","120"),i(R,"minlength","1"),i(T,"class","svelte-8zx99x"),i(p,"class","svelte-8zx99x"),i(c,"class","msg svelte-8zx99x"),i(r,"class","chatBX svelte-8zx99x"),i(_,"class","montserrat-alternates-bold svelte-8zx99x"),i(P,"class","userlist svelte-8zx99x"),i(d,"class",ce=G(`users ${a[5]?"showUserlist":""}`)+" svelte-8zx99x"),i(l,"class","svelte-8zx99x")},m(o,b){D&&D.m(o,b),C(o,e,b),ae(t,o,b),C(o,s,b),C(o,l,b),h(l,r),h(r,n);for(let f=0;f<M.length;f+=1)M[f]&&M[f].m(n,null);a[9](n),h(r,E),h(r,c),ae(k,c,null),h(c,m),h(c,p),h(p,R),Ue(R,a[0]),h(p,A),h(p,T),h(l,v),h(l,d),h(d,_),h(_,U),h(_,N),h(d,W),h(d,P);for(let f=0;f<w.length;f+=1)w[f]&&w[f].m(P,null);K=!0,ve||(Ee=[ee(R,"input",a[10]),ee(p,"submit",Ke(a[8]))],ve=!0)},p(o,[b]){if(o[4]?D?b&16&&z(D,1):(D=Le(),D.c(),z(D,1),D.m(e.parentNode,e)):D&&(Ie(),H(D,1,1,()=>{D=null}),ye()),b&8){F=he(o[3]);let f;for(f=0;f<F.length;f+=1){const q=Be(o,F,f);M[f]?(M[f].p(q,b),z(M[f],1)):(M[f]=ze(q),M[f].c(),z(M[f],1),M[f].m(n,null))}for(Ie(),f=F.length;f<M.length;f+=1)qe(f);ye()}if(b&1&&R.value!==o[0]&&Ue(R,o[0]),(!K||b&4)&&S!==(S=o[2].size+"")&&ie(N,S),b&4){J=he(o[2].entries());let f;for(f=0;f<J.length;f+=1){const q=De(o,J,f);w[f]?(w[f].p(q,b),z(w[f],1)):(w[f]=Ce(q),w[f].c(),z(w[f],1),w[f].m(P,null))}for(Ie(),f=J.length;f<w.length;f+=1)je(f);ye()}(!K||b&32&&ce!==(ce=G(`users ${o[5]?"showUserlist":""}`)+" svelte-8zx99x"))&&i(d,"class",ce)},i(o){if(!K){z(D),z(t.$$.fragment,o);for(let b=0;b<F.length;b+=1)z(M[b]);z(k.$$.fragment,o);for(let b=0;b<J.length;b+=1)z(w[b]);K=!0}},o(o){H(D),H(t.$$.fragment,o),M=M.filter(Boolean);for(let b=0;b<M.length;b+=1)H(M[b]);H(k.$$.fragment,o),w=w.filter(Boolean);for(let b=0;b<w.length;b+=1)H(w[b]);K=!1},d(o){o&&(g(e),g(s),g(l)),D&&D.d(o),le(t,o),Ae(M,o),a[9](null),le(k),Ae(w,o),ve=!1,Pe(Ee)}}}function pt(a){a.scroll({top:a.scrollHeight,behavior:"smooth"})}function gt(a,e,t){let s,l,r,n;Y(a,x,d=>t(11,s=d)),Y(a,me,d=>t(4,l=d)),Y(a,_e,d=>t(12,r=d)),Y(a,Ye,d=>t(5,n=d));let E="",c=null,k=[],m=[{username:"frensgo :",body:`Bienvenido a la sala ${r.room}`,type:"bot"}];function p(d){m.push(d),t(3,m)}function R(d){m.push(d),t(3,m)}Ne(()=>{s.send(JSON.stringify({type:"GETUSERLIST"}))}),He(()=>{s.close(),$(x,s=null,s)});function A(d,_){switch(d){case"USERLIST":const U=new Map(_);t(2,k=U);break;case"NEW_USER":const S={username:"frensgo :",body:_,type:"bot"};m.push(S),t(3,m);break;case"BYE_USER":const N={username:"frensgo :",body:_,type:"bot"};m.push(N),t(3,m);break;case"ROOM_MSG":m.push({..._,type:"room"}),t(3,m),m.length>=30&&(m.shift(),t(3,m)),setTimeout(()=>pt(c),.1);break;case"CALM":$(me,l=!0,l)}}$(x,s.onmessage=d=>{const{type:_,msg:U}=JSON.parse(d.data);A(_,U)},s),$(x,s.onclose=()=>{Ze("/rooms")},s);function T(){!E||E.length===0||E.length>120||(s.send(JSON.stringify({type:"ROOM_MSG",msg:E.trim()})),t(0,E=""))}function u(d){We[d?"unshift":"push"](()=>{c=d,t(1,c)})}function v(){E=this.value,t(0,E)}return[E,c,k,m,l,n,p,R,T,u,v]}class Tt extends ne{constructor(e){super(),oe(this,e,gt,mt,re,{})}}export{Tt as component,kt as universal};
