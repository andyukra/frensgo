import{m as ke,s as x,r as Pe,a as ue,b as be,d as ye,u as $e}from"../chunks/index.CspYxJ8V.js";import{s as oe,l as qe,y as Y,n as G,c as H,d as $,z as ee,o as je,A as Ce,r as He,f as Je}from"../chunks/scheduler.CHVDA16w.js";import{S as ie,i as ce,e as y,s as B,t as te,c as E,a as O,f as L,b as se,d as v,n as i,g as V,h,o as K,j as fe,m as we,y as le,z as ae,A as re,p as Me,q as Fe,k as R,l as z,u as _e,B as ne,C as Ue,w as ge}from"../chunks/index.DIjhlOJV.js";import{N as Xe}from"../chunks/Navbar.O26ja-Ke.js";import{g as We}from"../chunks/entry.H59JCB8p.js";function ve(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function Ye(){let l,e;if(ke.subscribe(t=>l=t),x.subscribe(t=>e=t),!l||!e)throw Pe(307,"/")}const It=Object.freeze(Object.defineProperty({__proto__:null,load:Ye},Symbol.toStringTag,{value:"Module"}));function Se(l){let e;return{c(){e=y("i"),this.h()},l(t){e=E(t,"I",{class:!0}),O(e).forEach(v),this.h()},h(){i(e,"class","fa-solid fa-circle-user svelte-10azm3p")},m(t,s){V(t,e,s)},d(t){t&&v(e)}}}function Ke(l){let e,t,s,a;return{c(){e=y("img"),this.h()},l(r){e=E(r,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){i(e,"class","typeImg svelte-10azm3p"),ee(e.src,t=l[0].body)||i(e,"src",t),i(e,"alt","Imagen subida Por un usuario")},m(r,o){V(r,e,o),s||(a=K(e,"click",l[7]),s=!0)},p(r,o){o&1&&!ee(e.src,t=r[0].body)&&i(e,"src",t)},d(r){r&&v(e),s=!1,a()}}}function Qe(l){let e,t;return{c(){e=y("audio"),this.h()},l(s){e=E(s,"AUDIO",{src:!0}),O(e).forEach(v),this.h()},h(){ee(e.src,t=l[0].body)||i(e,"src",t),e.controls=!0},m(s,a){V(s,e,a)},p(s,a){a&1&&!ee(e.src,t=s[0].body)&&i(e,"src",t)},d(s){s&&v(e)}}}function Ze(l){let e,t=l[0].body+"",s;return{c(){e=y("p"),s=te(t),this.h()},l(a){e=E(a,"P",{class:!0});var r=O(e);s=se(r,t),r.forEach(v),this.h()},h(){i(e,"class","montserrat-alternates-regular")},m(a,r){V(a,e,r),h(e,s)},p(a,r){r&1&&t!==(t=a[0].body+"")&&fe(s,t)},d(a){a&&v(e)}}}function xe(l){let e,t,s,a,r=decodeURI(l[0].username)+"",o,I,_,u,g,w,p,k;qe(l[6]);let f=l[0].type!==l[2].BOT&&Se();function S(c,T){if(c[0].type===c[2].ROOM||c[0].type===c[2].BOT)return Ze;if(c[0].type===c[2].AUDIO)return Qe;if(c[0].type===c[2].IMAGE)return Ke}let N=S(l),d=N&&N(l);return{c(){e=y("article"),t=y("div"),f&&f.c(),s=B(),a=y("h4"),o=te(r),I=B(),_=y("div"),u=y("div"),d&&d.c(),this.h()},l(c){e=E(c,"ARTICLE",{class:!0,style:!0});var T=O(e);t=E(T,"DIV",{class:!0});var j=O(t);f&&f.l(j),s=L(j),a=E(j,"H4",{class:!0});var C=O(a);o=se(C,r),C.forEach(v),j.forEach(v),I=L(T),_=E(T,"DIV",{class:!0});var q=O(_);u=E(q,"DIV",{class:!0});var Q=O(u);d&&d.l(Q),Q.forEach(v),q.forEach(v),T.forEach(v),this.h()},h(){i(a,"class","montserrat-alternates-bold svelte-10azm3p"),i(t,"class","username svelte-10azm3p"),i(u,"class",g=Y(`body ${l[0].type===l[2].BOT?"typeBot":l[0].type===l[2].AUDIO?"typeAudio":""}`)+" svelte-10azm3p"),i(_,"class","bodyBX"),i(e,"class",Y(`${l[3]?"me":""}`)+" svelte-10azm3p"),i(e,"style",w=l[5](l[1]))},m(c,T){V(c,e,T),h(e,t),f&&f.m(t,null),h(t,s),h(t,a),h(a,o),h(e,I),h(e,_),h(_,u),d&&d.m(u,null),p||(k=K(window,"resize",l[6]),p=!0)},p(c,[T]){c[0].type!==c[2].BOT?f||(f=Se(),f.c(),f.m(t,s)):f&&(f.d(1),f=null),T&1&&r!==(r=decodeURI(c[0].username)+"")&&fe(o,r),N===(N=S(c))&&d?d.p(c,T):(d&&d.d(1),d=N&&N(c),d&&(d.c(),d.m(u,null))),T&1&&g!==(g=Y(`body ${c[0].type===c[2].BOT?"typeBot":c[0].type===c[2].AUDIO?"typeAudio":""}`)+" svelte-10azm3p")&&i(u,"class",g),T&2&&w!==(w=c[5](c[1]))&&i(e,"style",w)},i:G,o:G,d(c){c&&v(e),f&&f.d(),d&&d.d(),p=!1,k()}}}function et(l,e,t){let s,a,r;H(l,ue,f=>t(8,s=f)),H(l,be,f=>t(9,a=f)),H(l,ke,f=>t(10,r=f));var o=(f=>(f.ROOM="room",f.BOT="bot",f.AUDIO="audio",f.IMAGE="image",f.YT="yt",f))(o||{});let{data:I}=e;const _=r.username===decodeURI(I.username);let u;function g(f){$(be,a=f.src,a),$(ue,s=!0,s)}function w(f){if(I.type==="bot")return"";let S="";return u<500&&(S+="flex-direction:column;gap:0.4rem !important;",_?S+="align-items:end;":S+="align-items:start;"),S}function p(){t(1,u=window.outerWidth)}const k=f=>g(f.target);return l.$$set=f=>{"data"in f&&t(0,I=f.data)},[I,u,o,_,g,w,p,k]}class tt extends ie{constructor(e){super(),ce(this,e,et,xe,oe,{data:0})}}function st(l){let e,t,s,a,r=decodeURI(l[1].username)+"",o,I,_;return{c(){e=y("article"),t=y("i"),s=B(),a=y("h4"),o=te(r),I=B(),_=y("i"),this.h()},l(u){e=E(u,"ARTICLE",{"data-id":!0,class:!0});var g=O(e);t=E(g,"I",{class:!0}),O(t).forEach(v),s=L(g),a=E(g,"H4",{class:!0});var w=O(a);o=se(w,r),w.forEach(v),I=L(g),_=E(g,"I",{class:!0}),O(_).forEach(v),g.forEach(v),this.h()},h(){i(t,"class","fa-solid fa-circle-user svelte-vv2xs7"),i(a,"class","montserrat-alternates-bold svelte-vv2xs7"),i(_,"class","fa-solid fa-circle-question svelte-vv2xs7"),i(e,"data-id",l[0]),i(e,"class","svelte-vv2xs7")},m(u,g){V(u,e,g),h(e,t),h(e,s),h(e,a),h(a,o),h(e,I),h(e,_)},p(u,[g]){g&2&&r!==(r=decodeURI(u[1].username)+"")&&fe(o,r),g&1&&i(e,"data-id",u[0])},i:G,o:G,d(u){u&&v(e)}}}function lt(l,e,t){let{id:s}=e,{data:a}=e;return l.$$set=r=>{"id"in r&&t(0,s=r.id),"data"in r&&t(1,a=r.data)},[s,a]}class at extends ie{constructor(e){super(),ce(this,e,lt,st,oe,{id:0,data:1})}}function rt(l){let e,t,s,a;return{c(){e=y("section"),t=y("article"),s=y("h4"),a=te(l[0]),this.h()},l(r){e=E(r,"SECTION",{class:!0});var o=O(e);t=E(o,"ARTICLE",{class:!0});var I=O(t);s=E(I,"H4",{class:!0});var _=O(s);a=se(_,l[0]),_.forEach(v),I.forEach(v),o.forEach(v),this.h()},h(){i(s,"class","montserrat-alternates-medium svelte-1b74fp1"),i(t,"class","svelte-1b74fp1"),i(e,"class","svelte-1b74fp1")},m(r,o){V(r,e,o),h(e,t),h(t,s),h(s,a)},p(r,[o]){o&1&&fe(a,r[0])},i:G,o:G,d(r){r&&v(e)}}}function nt(l,e,t){let s;H(l,ye,o=>t(2,s=o));let{msg:a}=e,{time:r}=e;return je(()=>{document.onkeydown=()=>!1}),Ce(()=>{document.onkeydown=null}),setTimeout(()=>$(ye,s=!1,s),r),l.$$set=o=>{"msg"in o&&t(0,a=o.msg),"time"in o&&t(1,r=o.time)},[a,r]}class ot extends ie{constructor(e){super(),ce(this,e,nt,rt,oe,{msg:0,time:1})}}function it(l){let e,t,s='<button class="montserrat-alternates-bold svelte-10wdjp4">T</button>',a,r,o,I,_,u='<i class="fa-solid fa-image svelte-10wdjp4"></i>',g,w,p,k,f,S,N;return{c(){e=y("div"),t=y("div"),t.innerHTML=s,a=B(),r=y("div"),o=y("input"),I=B(),_=y("label"),_.innerHTML=u,g=B(),w=y("div"),p=y("button"),k=y("i"),this.h()},l(d){e=E(d,"DIV",{class:!0});var c=O(e);t=E(c,"DIV",{class:!0,"data-svelte-h":!0}),we(t)!=="svelte-j39qlt"&&(t.innerHTML=s),a=L(c),r=E(c,"DIV",{class:!0});var T=O(r);o=E(T,"INPUT",{type:!0,accept:!0,id:!0}),I=L(T),_=E(T,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),we(_)!=="svelte-dbs90"&&(_.innerHTML=u),T.forEach(v),g=L(c),w=E(c,"DIV",{class:!0});var j=O(w);p=E(j,"BUTTON",{class:!0});var C=O(p);k=E(C,"I",{class:!0}),O(k).forEach(v),C.forEach(v),j.forEach(v),c.forEach(v),this.h()},h(){i(t,"class","txtStyle svelte-10wdjp4"),i(o,"type","file"),i(o,"accept","image/*"),o.hidden=!0,i(o,"id","upImg"),i(_,"for","upImg"),i(_,"class","svelte-10wdjp4"),i(r,"class","sendImg"),i(k,"class",f=Y(`fa-solid fa-microphone ${l[0]?"rec":"stop"}`)+" svelte-10wdjp4"),i(p,"class","svelte-10wdjp4"),i(w,"class","sendAudio"),i(e,"class","tools svelte-10wdjp4")},m(d,c){V(d,e,c),h(e,t),h(e,a),h(e,r),h(r,o),h(r,I),h(r,_),h(e,g),h(e,w),h(w,p),h(p,k),S||(N=[K(o,"change",l[2]),K(p,"click",l[1])],S=!0)},p(d,[c]){c&1&&f!==(f=Y(`fa-solid fa-microphone ${d[0]?"rec":"stop"}`)+" svelte-10wdjp4")&&i(k,"class",f)},i:G,o:G,d(d){d&&v(e),S=!1,He(N)}}}const De="https://frensgo.lat";function ct(l,e,t){let s;H(l,x,g=>t(4,s=g));let a=null,r=!1;function o(){a||r||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:!0}).then(g=>{a=new MediaRecorder(g);let w=[];a.ondataavailable=p=>{w.push(p.data)},a.onstop=async()=>{const p=new Blob(w,{type:"audio/ogg;codecs=opus"});w=[];const k=new FormData;k.append("audio",p);const S=await(await fetch(`${De}/audio`,{method:"POST",body:k})).text();s.send(JSON.stringify({type:"AUDIO",msg:S}))},a.start(),t(0,r=!0)}).catch(g=>console.log(g))}function I(){a&&r&&(a.stop(),a=null,t(0,r=!1))}function _(){r?I():o()}async function u(g){const w=g.target.files[0];if(w.size>5e6){alert("La imágen es muy pesada");return}if(!/^image\/....?$/.test(w.type)){alert("Por favor elija una imágen válida");return}const p=new FormData;p.append("image",w);const f=await(await fetch(`${De}/upImg`,{method:"POST",body:p})).text();s.send(JSON.stringify({type:"IMG",msg:f}))}return[r,_,u]}class ut extends ie{constructor(e){super(),ce(this,e,ct,it,oe,{})}}function ft(l){let e,t,s,a,r,o,I;return{c(){e=y("div"),t=y("i"),s=B(),a=y("img"),this.h()},l(_){e=E(_,"DIV",{class:!0});var u=O(e);t=E(u,"I",{class:!0}),O(t).forEach(v),s=L(u),a=E(u,"IMG",{src:!0,alt:!0,class:!0}),u.forEach(v),this.h()},h(){i(t,"class","fas fa-times svelte-6bka76"),ee(a.src,r=l[1])||i(a,"src",r),i(a,"alt","Una imagen"),i(a,"class","svelte-6bka76"),i(e,"class","modal svelte-6bka76")},m(_,u){V(_,e,u),h(e,t),h(e,s),h(e,a),o||(I=K(t,"click",l[2]),o=!0)},p(_,[u]){u&2&&!ee(a.src,r=_[1])&&i(a,"src",r)},i:G,o:G,d(_){_&&v(e),o=!1,I()}}}function dt(l,e,t){let s,a;return H(l,ue,o=>t(0,s=o)),H(l,be,o=>t(1,a=o)),[s,a,()=>$(ue,s=!1,s)]}class mt extends ie{constructor(e){super(),ce(this,e,dt,ft,oe,{})}}function Ae(l,e,t){const s=l.slice();return s[15]=e[t][0],s[16]=e[t][1],s}function Re(l,e,t){const s=l.slice();return s[19]=e[t],s}function Be(l){let e,t;return e=new ot({props:{msg:"Aver si nos calmamos un poquito :)",time:5e3}}),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},i(s){t||(R(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){ne(e,s)}}}function Le(l){let e,t;return e=new mt({}),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},i(s){t||(R(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){ne(e,s)}}}function Ne(l){let e,t;return e=new tt({props:{data:l[19]}}),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},p(s,a){const r={};a&8&&(r.data=s[19]),e.$set(r)},i(s){t||(R(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){ne(e,s)}}}function ze(l){let e,t;return e=new at({props:{id:l[15],data:l[16]}}),{c(){le(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){re(e,s,a),t=!0},p(s,a){const r={};a&4&&(r.id=s[15]),a&4&&(r.data=s[16]),e.$set(r)},i(s){t||(R(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){ne(e,s)}}}function ht(l){let e,t,s,a,r,o,I,_,u,g,w,p,k,f,S,N='<i class="fa-solid fa-paper-plane svelte-10t8t63"></i>',d,c,T,j,C=l[2].size+"",q,Q,J,de,Z,Ee,Oe,D=l[4]&&Be(),A=l[5]&&l[6]&&Le();s=new Xe({});let F=ve(l[3]),M=[];for(let n=0;n<F.length;n+=1)M[n]=Ne(Re(l,F,n));const Ve=n=>z(M[n],1,1,()=>{M[n]=null});g=new ut({});let X=ve(l[2].entries()),U=[];for(let n=0;n<X.length;n+=1)U[n]=ze(Ae(l,X,n));const Ge=n=>z(U[n],1,1,()=>{U[n]=null});return{c(){D&&D.c(),e=B(),A&&A.c(),t=B(),le(s.$$.fragment),a=B(),r=y("section"),o=y("article"),I=y("div");for(let n=0;n<M.length;n+=1)M[n].c();_=B(),u=y("div"),le(g.$$.fragment),w=B(),p=y("form"),k=y("input"),f=B(),S=y("button"),S.innerHTML=N,d=B(),c=y("article"),T=y("h3"),j=te("Usuarios conectados: "),q=te(C),Q=B(),J=y("div");for(let n=0;n<U.length;n+=1)U[n].c();this.h()},l(n){D&&D.l(n),e=L(n),A&&A.l(n),t=L(n),ae(s.$$.fragment,n),a=L(n),r=E(n,"SECTION",{class:!0});var b=O(r);o=E(b,"ARTICLE",{class:!0});var m=O(o);I=E(m,"DIV",{class:!0});var P=O(I);for(let W=0;W<M.length;W+=1)M[W].l(P);P.forEach(v),_=L(m),u=E(m,"DIV",{class:!0});var me=O(u);ae(g.$$.fragment,me),w=L(me),p=E(me,"FORM",{class:!0});var he=O(p);k=E(he,"INPUT",{class:!0,type:!0,placeholder:!0,maxlength:!0,minlength:!0}),f=L(he),S=E(he,"BUTTON",{class:!0,"data-svelte-h":!0}),we(S)!=="svelte-1m1u804"&&(S.innerHTML=N),he.forEach(v),me.forEach(v),m.forEach(v),d=L(b),c=E(b,"ARTICLE",{class:!0});var pe=O(c);T=E(pe,"H3",{class:!0});var Ie=O(T);j=se(Ie,"Usuarios conectados: "),q=se(Ie,C),Ie.forEach(v),Q=L(pe),J=E(pe,"DIV",{class:!0});var Te=O(J);for(let W=0;W<U.length;W+=1)U[W].l(Te);Te.forEach(v),pe.forEach(v),b.forEach(v),this.h()},h(){i(I,"class","chat svelte-10t8t63"),i(k,"class","montserrat-alternates-regular svelte-10t8t63"),i(k,"type","text"),i(k,"placeholder","Escribe tu mensaje..."),i(k,"maxlength","120"),i(k,"minlength","1"),i(S,"class","svelte-10t8t63"),i(p,"class","svelte-10t8t63"),i(u,"class","msg svelte-10t8t63"),i(o,"class","chatBX svelte-10t8t63"),i(T,"class","montserrat-alternates-bold svelte-10t8t63"),i(J,"class","userlist svelte-10t8t63"),i(c,"class",de=Y(`users ${l[7]?"showUserlist":""}`)+" svelte-10t8t63"),i(r,"class","svelte-10t8t63")},m(n,b){D&&D.m(n,b),V(n,e,b),A&&A.m(n,b),V(n,t,b),re(s,n,b),V(n,a,b),V(n,r,b),h(r,o),h(o,I);for(let m=0;m<M.length;m+=1)M[m]&&M[m].m(I,null);l[9](I),h(o,_),h(o,u),re(g,u,null),h(u,w),h(u,p),h(p,k),Me(k,l[0]),h(p,f),h(p,S),h(r,d),h(r,c),h(c,T),h(T,j),h(T,q),h(c,Q),h(c,J);for(let m=0;m<U.length;m+=1)U[m]&&U[m].m(J,null);Z=!0,Ee||(Oe=[K(k,"input",l[10]),K(p,"submit",Fe(l[8]))],Ee=!0)},p(n,[b]){if(n[4]?D?b&16&&R(D,1):(D=Be(),D.c(),R(D,1),D.m(e.parentNode,e)):D&&(ge(),z(D,1,1,()=>{D=null}),_e()),n[5]&&n[6]?A?b&96&&R(A,1):(A=Le(),A.c(),R(A,1),A.m(t.parentNode,t)):A&&(ge(),z(A,1,1,()=>{A=null}),_e()),b&8){F=ve(n[3]);let m;for(m=0;m<F.length;m+=1){const P=Re(n,F,m);M[m]?(M[m].p(P,b),R(M[m],1)):(M[m]=Ne(P),M[m].c(),R(M[m],1),M[m].m(I,null))}for(ge(),m=F.length;m<M.length;m+=1)Ve(m);_e()}if(b&1&&k.value!==n[0]&&Me(k,n[0]),(!Z||b&4)&&C!==(C=n[2].size+"")&&fe(q,C),b&4){X=ve(n[2].entries());let m;for(m=0;m<X.length;m+=1){const P=Ae(n,X,m);U[m]?(U[m].p(P,b),R(U[m],1)):(U[m]=ze(P),U[m].c(),R(U[m],1),U[m].m(J,null))}for(ge(),m=X.length;m<U.length;m+=1)Ge(m);_e()}(!Z||b&128&&de!==(de=Y(`users ${n[7]?"showUserlist":""}`)+" svelte-10t8t63"))&&i(c,"class",de)},i(n){if(!Z){R(D),R(A),R(s.$$.fragment,n);for(let b=0;b<F.length;b+=1)R(M[b]);R(g.$$.fragment,n);for(let b=0;b<X.length;b+=1)R(U[b]);Z=!0}},o(n){z(D),z(A),z(s.$$.fragment,n),M=M.filter(Boolean);for(let b=0;b<M.length;b+=1)z(M[b]);z(g.$$.fragment,n),U=U.filter(Boolean);for(let b=0;b<U.length;b+=1)z(U[b]);Z=!1},d(n){n&&(v(e),v(t),v(a),v(r)),D&&D.d(n),A&&A.d(n),ne(s,n),Ue(M,n),l[9](null),ne(g),Ue(U,n),Ee=!1,He(Oe)}}}function pt(l){l.scroll({top:l.scrollHeight,behavior:"smooth"})}function _t(l,e,t){let s,a,r,o,I,_;H(l,x,d=>t(11,s=d)),H(l,ye,d=>t(4,a=d)),H(l,ke,d=>t(12,r=d)),H(l,ue,d=>t(5,o=d)),H(l,be,d=>t(6,I=d)),H(l,$e,d=>t(7,_=d));let u="",g=null,w=[],p=[{username:"frensgo :",body:`Bienvenido a la sala ${r.room}`,type:"bot"}];je(()=>{s.send(JSON.stringify({type:"GETUSERLIST"}))}),Ce(()=>{s.close(),$(x,s=null,s)});function k(d,c){switch(d){case"USERLIST":const T=new Map(c);t(2,w=T);break;case"NEW_USER":const j={username:"frensgo :",body:c,type:"bot"};p.push(j),t(3,p);break;case"BYE_USER":const C={username:"frensgo :",body:c,type:"bot"};p.push(C),t(3,p);break;case"ROOM_MSG":p.push({...c,type:"room"}),t(3,p),p.length>=30&&(p.shift(),t(3,p)),setTimeout(()=>pt(g),.1);break;case"CALM":$(ye,a=!0,a);break;case"AUDIO":p.push({...c,type:"audio"}),t(3,p);break;case"IMG":p.push({...c,type:"image"}),t(3,p);break}}$(x,s.onmessage=d=>{const{type:c,msg:T}=JSON.parse(d.data);k(c,T)},s),$(x,s.onclose=()=>{We("/rooms")},s);function f(){!u||u.length===0||u.length>120||(s.send(JSON.stringify({type:"ROOM_MSG",msg:u.trim()})),t(0,u=""))}function S(d){Je[d?"unshift":"push"](()=>{g=d,t(1,g)})}function N(){u=this.value,t(0,u)}return[u,g,w,p,a,o,I,_,f,S,N]}class wt extends ie{constructor(e){super(),ce(this,e,_t,ht,oe,{})}}export{wt as component,It as universal};
