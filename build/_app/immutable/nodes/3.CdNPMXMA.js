var je=Object.defineProperty;var Oe=a=>{throw TypeError(a)};var Je=(a,e,t)=>e in a?je(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var q=(a,e,t)=>Je(a,typeof e!="symbol"?e+"":e,t),Fe=(a,e,t)=>e.has(a)||Oe("Cannot "+t);var Te=(a,e,t)=>e.has(a)?Oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t);var Re=(a,e,t)=>(Fe(a,e,"access private method"),t);import{m as Ee,s as K,r as $e,d as me,u as Xe}from"../chunks/index.Bgk_tAtE.js";import{s as re,y as j,n as V,c as X,z as pe,o as Ce,A as He,d as x,r as Pe,f as Ye}from"../chunks/scheduler.CHVDA16w.js";import{S as ne,i as oe,e as g,s as B,t as Q,c as b,a as O,f as L,b as Z,d as _,n as c,g as N,h as d,j as ie,m as _e,o as ee,y as te,z as se,A as ae,p as Ue,q as We,k as z,l as C,u as be,B as le,C as Me,w as ye}from"../chunks/index.DIjhlOJV.js";import{N as Ke}from"../chunks/Navbar.gehibIF6.js";import{g as Qe}from"../chunks/entry.DbnB_DfK.js";function he(a){return(a==null?void 0:a.length)!==void 0?a:Array.from(a)}function Ze(){let a,e;if(Ee.subscribe(t=>a=t),K.subscribe(t=>e=t),!a||!e)throw $e(307,"/")}const kt=Object.freeze(Object.defineProperty({__proto__:null,load:Ze},Symbol.toStringTag,{value:"Module"}));function we(a){let e;return{c(){e=g("i"),this.h()},l(t){e=b(t,"I",{class:!0}),O(e).forEach(_),this.h()},h(){c(e,"class","fa-solid fa-circle-user svelte-42ha35")},m(t,s){N(t,e,s)},d(t){t&&_(e)}}}function xe(a){let e,t;return{c(){e=g("img"),this.h()},l(s){e=b(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){c(e,"class","typeImg svelte-42ha35"),pe(e.src,t=a[0].body)||c(e,"src",t),c(e,"alt","Imagen subida Por un usuario")},m(s,l){N(s,e,l)},p(s,l){l&1&&!pe(e.src,t=s[0].body)&&c(e,"src",t)},d(s){s&&_(e)}}}function et(a){let e,t;return{c(){e=g("audio"),this.h()},l(s){e=b(s,"AUDIO",{src:!0}),O(e).forEach(_),this.h()},h(){pe(e.src,t=a[0].body)||c(e,"src",t),e.controls=!0},m(s,l){N(s,e,l)},p(s,l){l&1&&!pe(e.src,t=s[0].body)&&c(e,"src",t)},d(s){s&&_(e)}}}function tt(a){let e,t=a[0].body+"",s;return{c(){e=g("p"),s=Q(t),this.h()},l(l){e=b(l,"P",{class:!0});var r=O(e);s=Z(r,t),r.forEach(_),this.h()},h(){c(e,"class","montserrat-alternates-regular")},m(l,r){N(l,e,r),d(e,s)},p(l,r){r&1&&t!==(t=l[0].body+"")&&ie(s,t)},d(l){l&&_(e)}}}function st(a){let e,t,s,l,r=decodeURI(a[0].username)+"",n,E,h,I,p,m=a[0].type!==a[2].BOT&&we();function T(o,y){if(o[0].type===o[2].ROOM||o[0].type===o[2].BOT)return tt;if(o[0].type===o[2].AUDIO)return et;if(o[0].type===o[2].IMAGE)return xe}let U=T(a),f=U&&U(a);return{c(){e=g("article"),t=g("div"),m&&m.c(),s=B(),l=g("h4"),n=Q(r),E=B(),h=g("div"),f&&f.c(),this.h()},l(o){e=b(o,"ARTICLE",{class:!0});var y=O(e);t=b(y,"DIV",{class:!0});var R=O(t);m&&m.l(R),s=L(R),l=b(R,"H4",{class:!0});var k=O(l);n=Z(k,r),k.forEach(_),R.forEach(_),E=L(y),h=b(y,"DIV",{class:!0});var S=O(h);f&&f.l(S),S.forEach(_),y.forEach(_),this.h()},h(){c(l,"class","montserrat-alternates-bold svelte-42ha35"),c(t,"class","username svelte-42ha35"),c(h,"class",I=j(`body ${a[0].type===a[2].BOT?"typeBot":a[0].type===a[2].AUDIO?"typeAudio":""}`)+" svelte-42ha35"),c(e,"class",p=j(a[1].username===decodeURI(a[0].username)?"me":"")+" svelte-42ha35")},m(o,y){N(o,e,y),d(e,t),m&&m.m(t,null),d(t,s),d(t,l),d(l,n),d(e,E),d(e,h),f&&f.m(h,null)},p(o,[y]){o[0].type!==o[2].BOT?m||(m=we(),m.c(),m.m(t,s)):m&&(m.d(1),m=null),y&1&&r!==(r=decodeURI(o[0].username)+"")&&ie(n,r),U===(U=T(o))&&f?f.p(o,y):(f&&f.d(1),f=U&&U(o),f&&(f.c(),f.m(h,null))),y&1&&I!==(I=j(`body ${o[0].type===o[2].BOT?"typeBot":o[0].type===o[2].AUDIO?"typeAudio":""}`)+" svelte-42ha35")&&c(h,"class",I),y&3&&p!==(p=j(o[1].username===decodeURI(o[0].username)?"me":"")+" svelte-42ha35")&&c(e,"class",p)},i:V,o:V,d(o){o&&_(e),m&&m.d(),f&&f.d()}}}function at(a,e,t){let s;X(a,Ee,n=>t(1,s=n));var l=(n=>(n.ROOM="room",n.BOT="bot",n.AUDIO="audio",n.IMAGE="image",n.YT="yt",n))(l||{});let{data:r}=e;return a.$$set=n=>{"data"in n&&t(0,r=n.data)},[r,s,l]}class lt extends ne{constructor(e){super(),oe(this,e,at,st,re,{data:0})}}function rt(a){let e,t,s,l,r=decodeURI(a[1].username)+"",n,E,h;return{c(){e=g("article"),t=g("i"),s=B(),l=g("h4"),n=Q(r),E=B(),h=g("i"),this.h()},l(I){e=b(I,"ARTICLE",{"data-id":!0,class:!0});var p=O(e);t=b(p,"I",{class:!0}),O(t).forEach(_),s=L(p),l=b(p,"H4",{class:!0});var m=O(l);n=Z(m,r),m.forEach(_),E=L(p),h=b(p,"I",{class:!0}),O(h).forEach(_),p.forEach(_),this.h()},h(){c(t,"class","fa-solid fa-circle-user svelte-vv2xs7"),c(l,"class","montserrat-alternates-bold svelte-vv2xs7"),c(h,"class","fa-solid fa-circle-question svelte-vv2xs7"),c(e,"data-id",a[0]),c(e,"class","svelte-vv2xs7")},m(I,p){N(I,e,p),d(e,t),d(e,s),d(e,l),d(l,n),d(e,E),d(e,h)},p(I,[p]){p&2&&r!==(r=decodeURI(I[1].username)+"")&&ie(n,r),p&1&&c(e,"data-id",I[0])},i:V,o:V,d(I){I&&_(e)}}}function nt(a,e,t){let{id:s}=e,{data:l}=e;return a.$$set=r=>{"id"in r&&t(0,s=r.id),"data"in r&&t(1,l=r.data)},[s,l]}class ot extends ne{constructor(e){super(),oe(this,e,nt,rt,re,{id:0,data:1})}}function it(a){let e,t,s,l;return{c(){e=g("section"),t=g("article"),s=g("h4"),l=Q(a[0]),this.h()},l(r){e=b(r,"SECTION",{class:!0});var n=O(e);t=b(n,"ARTICLE",{class:!0});var E=O(t);s=b(E,"H4",{class:!0});var h=O(s);l=Z(h,a[0]),h.forEach(_),E.forEach(_),n.forEach(_),this.h()},h(){c(s,"class","montserrat-alternates-medium svelte-1b74fp1"),c(t,"class","svelte-1b74fp1"),c(e,"class","svelte-1b74fp1")},m(r,n){N(r,e,n),d(e,t),d(t,s),d(s,l)},p(r,[n]){n&1&&ie(l,r[0])},i:V,o:V,d(r){r&&_(e)}}}function ct(a,e,t){let s;X(a,me,n=>t(2,s=n));let{msg:l}=e,{time:r}=e;return Ce(()=>{document.onkeydown=()=>!1}),He(()=>{document.onkeydown=null}),setTimeout(()=>x(me,s=!1,s),r),a.$$set=n=>{"msg"in n&&t(0,l=n.msg),"time"in n&&t(1,r=n.time)},[l,r]}class ut extends ne{constructor(e){super(),oe(this,e,ct,it,re,{msg:0,time:1})}}function Se(a){let e,t='<i class="fa-solid fa-stop svelte-1in8yok"></i>',s,l;return{c(){e=g("button"),e.innerHTML=t,this.h()},l(r){e=b(r,"BUTTON",{class:!0,"data-svelte-h":!0}),_e(e)!=="svelte-1lqnh5p"&&(e.innerHTML=t),this.h()},h(){c(e,"class","svelte-1in8yok")},m(r,n){N(r,e,n),s||(l=ee(e,"click",a[4]),s=!0)},p:V,d(r){r&&_(e),s=!1,l()}}}function ft(a){let e,t,s='<button class="montserrat-alternates-bold svelte-1in8yok">T</button>',l,r,n,E,h,I='<i class="fa-solid fa-image svelte-1in8yok"></i>',p,m,T,U,f,o,y,R,k=a[0]&&Se(a);return{c(){e=g("div"),t=g("div"),t.innerHTML=s,l=B(),r=g("div"),n=g("input"),E=B(),h=g("label"),h.innerHTML=I,p=B(),m=g("div"),T=g("button"),U=g("i"),o=B(),k&&k.c(),this.h()},l(S){e=b(S,"DIV",{class:!0});var A=O(e);t=b(A,"DIV",{class:!0,"data-svelte-h":!0}),_e(t)!=="svelte-j39qlt"&&(t.innerHTML=s),l=L(A),r=b(A,"DIV",{class:!0});var P=O(r);n=b(P,"INPUT",{type:!0,accept:!0,id:!0}),E=L(P),h=b(P,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),_e(h)!=="svelte-dbs90"&&(h.innerHTML=I),P.forEach(_),p=L(A),m=b(A,"DIV",{class:!0});var Y=O(m);T=b(Y,"BUTTON",{class:!0});var H=O(T);U=b(H,"I",{class:!0}),O(U).forEach(_),H.forEach(_),Y.forEach(_),o=L(A),k&&k.l(A),A.forEach(_),this.h()},h(){c(t,"class","txtStyle svelte-1in8yok"),c(n,"type","file"),c(n,"accept","image/*"),n.hidden=!0,c(n,"id","upImg"),c(h,"for","upImg"),c(h,"class","svelte-1in8yok"),c(r,"class","sendImg"),c(U,"class",f=j(`fa-solid fa-microphone ${a[1]}`)+" svelte-1in8yok"),T.disabled=a[2].audioState,c(T,"class","svelte-1in8yok"),c(m,"class","sendAudio"),c(e,"class","tools svelte-1in8yok")},m(S,A){N(S,e,A),d(e,t),d(e,l),d(e,r),d(r,n),d(r,E),d(r,h),d(e,p),d(e,m),d(m,T),d(T,U),d(e,o),k&&k.m(e,null),y||(R=[ee(n,"change",a[5]),ee(T,"click",a[3])],y=!0)},p(S,[A]){A&2&&f!==(f=j(`fa-solid fa-microphone ${S[1]}`)+" svelte-1in8yok")&&c(U,"class",f),S[0]?k?k.p(S,A):(k=Se(S),k.c(),k.m(e,null)):k&&(k.d(1),k=null)},i:V,o:V,d(S){S&&_(e),k&&k.d(),y=!1,Pe(R)}}}const Ae="http://localhost:3000";function dt(a,e,t){var m,Ve;let s;X(a,K,U=>t(6,s=U));class l{constructor(){Te(this,m);q(this,"constraints");q(this,"chunks");q(this,"mediaRecorder");q(this,"audioURL");q(this,"audioState",!0);q(this,"state");q(this,"timeOut");navigator.mediaDevices&&(this.constraints={audio:!0},this.chunks=[],this.audioState=!1)}getDevices(){navigator.mediaDevices.getUserMedia(this.constraints).then(f=>{this.mediaRecorder=new MediaRecorder(f),this.mediaRecorder.ondataavailable=o=>{this.chunks.push(o.data)},this.mediaRecorder.onstop=async o=>{if(!this.state){this.chunks=[];return}const y=new Blob(this.chunks,{type:"audio/ogg;codecs=opus"});this.chunks=[];const R=await Re(this,m,Ve).call(this,y);s.send(JSON.stringify({type:"AUDIO",msg:R}))}})}start(){return this.mediaRecorder&&(this.mediaRecorder.state==="inactive"||this.mediaRecorder.state==="paused")?(this.mediaRecorder.start(),this.timeOut=setTimeout(()=>{var f;return(f=this.mediaRecorder)==null?void 0:f.stop()},18e4),!0):!1}stop(f){return this.mediaRecorder&&this.mediaRecorder.state==="recording"?(clearTimeout(this.timeOut),this.state=f,this.mediaRecorder.stop(),!1):!0}}m=new WeakSet,Ve=async function(f){const o=new FormData;return o.append("audio",f),await(await fetch(`${Ae}/audio`,{method:"POST",body:o})).text()};const r=new l;r.getDevices();let n=!1,E="stop";function h(){n?(t(0,n=r.stop(!0)),t(1,E="stop")):(t(0,n=r.start()),t(1,E="rec"))}function I(){t(0,n=r.stop(!1)),t(1,E="stop")}async function p(U){const f=U.target.files[0];if(f.size>5e6){alert("La imágen es muy pesada");return}if(!/^image\/....?$/.test(f.type)){alert("Por favor elija una imágen válida");return}const o=new FormData;o.append("image",f);const R=await(await fetch(`${Ae}/upImg`,{method:"POST",body:o})).text();s.send(JSON.stringify({type:"IMG",msg:R}))}return[n,E,r,h,I,p]}class ht extends ne{constructor(e){super(),oe(this,e,dt,ft,re,{})}}function De(a,e,t){const s=a.slice();return s[13]=e[t][0],s[14]=e[t][1],s}function Be(a,e,t){const s=a.slice();return s[17]=e[t],s}function Le(a){let e,t;return e=new ut({props:{msg:"Aver si nos calmamos un poquito :)",time:5e3}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function ze(a){let e,t;return e=new lt({props:{data:a[17]}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},p(s,l){const r={};l&8&&(r.data=s[17]),e.$set(r)},i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Ne(a){let e,t;return e=new ot({props:{id:a[13],data:a[14]}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},p(s,l){const r={};l&4&&(r.id=s[13]),l&4&&(r.data=s[14]),e.$set(r)},i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function mt(a){let e,t,s,l,r,n,E,h,I,p,m,T,U,f,o='<i class="fa-solid fa-paper-plane svelte-8zx99x"></i>',y,R,k,S,A=a[2].size+"",P,Y,H,ce,W,ve,Ie,D=a[4]&&Le();t=new Ke({});let J=he(a[3]),M=[];for(let i=0;i<J.length;i+=1)M[i]=ze(Be(a,J,i));const Ge=i=>C(M[i],1,1,()=>{M[i]=null});I=new ht({});let F=he(a[2].entries()),w=[];for(let i=0;i<F.length;i+=1)w[i]=Ne(De(a,F,i));const qe=i=>C(w[i],1,1,()=>{w[i]=null});return{c(){D&&D.c(),e=B(),te(t.$$.fragment),s=B(),l=g("section"),r=g("article"),n=g("div");for(let i=0;i<M.length;i+=1)M[i].c();E=B(),h=g("div"),te(I.$$.fragment),p=B(),m=g("form"),T=g("input"),U=B(),f=g("button"),f.innerHTML=o,y=B(),R=g("article"),k=g("h3"),S=Q("Usuarios conectados: "),P=Q(A),Y=B(),H=g("div");for(let i=0;i<w.length;i+=1)w[i].c();this.h()},l(i){D&&D.l(i),e=L(i),se(t.$$.fragment,i),s=L(i),l=b(i,"SECTION",{class:!0});var v=O(l);r=b(v,"ARTICLE",{class:!0});var u=O(r);n=b(u,"DIV",{class:!0});var G=O(n);for(let $=0;$<M.length;$+=1)M[$].l(G);G.forEach(_),E=L(u),h=b(u,"DIV",{class:!0});var ue=O(h);se(I.$$.fragment,ue),p=L(ue),m=b(ue,"FORM",{class:!0});var fe=O(m);T=b(fe,"INPUT",{class:!0,type:!0,placeholder:!0,maxlength:!0,minlength:!0}),U=L(fe),f=b(fe,"BUTTON",{class:!0,"data-svelte-h":!0}),_e(f)!=="svelte-1m1u804"&&(f.innerHTML=o),fe.forEach(_),ue.forEach(_),u.forEach(_),y=L(v),R=b(v,"ARTICLE",{class:!0});var de=O(R);k=b(de,"H3",{class:!0});var ge=O(k);S=Z(ge,"Usuarios conectados: "),P=Z(ge,A),ge.forEach(_),Y=L(de),H=b(de,"DIV",{class:!0});var ke=O(H);for(let $=0;$<w.length;$+=1)w[$].l(ke);ke.forEach(_),de.forEach(_),v.forEach(_),this.h()},h(){c(n,"class","chat svelte-8zx99x"),c(T,"class","montserrat-alternates-regular svelte-8zx99x"),c(T,"type","text"),c(T,"placeholder","Escribe tu mensaje..."),c(T,"maxlength","120"),c(T,"minlength","1"),c(f,"class","svelte-8zx99x"),c(m,"class","svelte-8zx99x"),c(h,"class","msg svelte-8zx99x"),c(r,"class","chatBX svelte-8zx99x"),c(k,"class","montserrat-alternates-bold svelte-8zx99x"),c(H,"class","userlist svelte-8zx99x"),c(R,"class",ce=j(`users ${a[5]?"showUserlist":""}`)+" svelte-8zx99x"),c(l,"class","svelte-8zx99x")},m(i,v){D&&D.m(i,v),N(i,e,v),ae(t,i,v),N(i,s,v),N(i,l,v),d(l,r),d(r,n);for(let u=0;u<M.length;u+=1)M[u]&&M[u].m(n,null);a[7](n),d(r,E),d(r,h),ae(I,h,null),d(h,p),d(h,m),d(m,T),Ue(T,a[0]),d(m,U),d(m,f),d(l,y),d(l,R),d(R,k),d(k,S),d(k,P),d(R,Y),d(R,H);for(let u=0;u<w.length;u+=1)w[u]&&w[u].m(H,null);W=!0,ve||(Ie=[ee(T,"input",a[8]),ee(m,"submit",We(a[6]))],ve=!0)},p(i,[v]){if(i[4]?D?v&16&&z(D,1):(D=Le(),D.c(),z(D,1),D.m(e.parentNode,e)):D&&(ye(),C(D,1,1,()=>{D=null}),be()),v&8){J=he(i[3]);let u;for(u=0;u<J.length;u+=1){const G=Be(i,J,u);M[u]?(M[u].p(G,v),z(M[u],1)):(M[u]=ze(G),M[u].c(),z(M[u],1),M[u].m(n,null))}for(ye(),u=J.length;u<M.length;u+=1)Ge(u);be()}if(v&1&&T.value!==i[0]&&Ue(T,i[0]),(!W||v&4)&&A!==(A=i[2].size+"")&&ie(P,A),v&4){F=he(i[2].entries());let u;for(u=0;u<F.length;u+=1){const G=De(i,F,u);w[u]?(w[u].p(G,v),z(w[u],1)):(w[u]=Ne(G),w[u].c(),z(w[u],1),w[u].m(H,null))}for(ye(),u=F.length;u<w.length;u+=1)qe(u);be()}(!W||v&32&&ce!==(ce=j(`users ${i[5]?"showUserlist":""}`)+" svelte-8zx99x"))&&c(R,"class",ce)},i(i){if(!W){z(D),z(t.$$.fragment,i);for(let v=0;v<J.length;v+=1)z(M[v]);z(I.$$.fragment,i);for(let v=0;v<F.length;v+=1)z(w[v]);W=!0}},o(i){C(D),C(t.$$.fragment,i),M=M.filter(Boolean);for(let v=0;v<M.length;v+=1)C(M[v]);C(I.$$.fragment,i),w=w.filter(Boolean);for(let v=0;v<w.length;v+=1)C(w[v]);W=!1},d(i){i&&(_(e),_(s),_(l)),D&&D.d(i),le(t,i),Me(M,i),a[7](null),le(I),Me(w,i),ve=!1,Pe(Ie)}}}function pt(a){a.scroll({top:a.scrollHeight,behavior:"smooth"})}function _t(a,e,t){let s,l,r,n;X(a,K,o=>t(9,s=o)),X(a,me,o=>t(4,l=o)),X(a,Ee,o=>t(10,r=o)),X(a,Xe,o=>t(5,n=o));let E="",h=null,I=[],p=[{username:"frensgo :",body:`Bienvenido a la sala ${r.room}`,type:"bot"}];Ce(()=>{s.send(JSON.stringify({type:"GETUSERLIST"}))}),He(()=>{s.close(),x(K,s=null,s)});function m(o,y){switch(o){case"USERLIST":const R=new Map(y);t(2,I=R);break;case"NEW_USER":const k={username:"frensgo :",body:y,type:"bot"};p.push(k),t(3,p);break;case"BYE_USER":const S={username:"frensgo :",body:y,type:"bot"};p.push(S),t(3,p);break;case"ROOM_MSG":p.push({...y,type:"room"}),t(3,p),p.length>=30&&(p.shift(),t(3,p)),setTimeout(()=>pt(h),.1);break;case"CALM":x(me,l=!0,l);break;case"AUDIO":p.push({...y,type:"audio"}),t(3,p);break;case"IMG":p.push({...y,type:"image"}),t(3,p);break}}x(K,s.onmessage=o=>{const{type:y,msg:R}=JSON.parse(o.data);m(y,R)},s),x(K,s.onclose=()=>{Qe("/rooms")},s);function T(){!E||E.length===0||E.length>120||(s.send(JSON.stringify({type:"ROOM_MSG",msg:E.trim()})),t(0,E=""))}function U(o){Ye[o?"unshift":"push"](()=>{h=o,t(1,h)})}function f(){E=this.value,t(0,E)}return[E,h,I,p,l,n,T,U,f]}class Ot extends ne{constructor(e){super(),oe(this,e,_t,mt,re,{})}}export{Ot as component,kt as universal};
