var Ge=Object.defineProperty;var Te=a=>{throw TypeError(a)};var Fe=(a,e,t)=>e in a?Ge(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var j=(a,e,t)=>Fe(a,typeof e!="symbol"?e+"":e,t),Je=(a,e,t)=>e.has(a)||Te("Cannot "+t);var Re=(a,e,t)=>e.has(a)?Te("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t);var ze=(a,e,t)=>(Je(a,e,"access private method"),t);import{m as pe,s as x,r as Xe,d as me,u as Ye}from"../chunks/index.C5u3pake.js";import{s as re,y as G,n as P,c as Y,z as ge,o as Ce,A as Ne,d as $,r as He,f as We}from"../chunks/scheduler.CHVDA16w.js";import{S as ne,i as oe,e as y,s as B,t as Q,c as k,a as z,f as D,b as Z,d as _,n as i,g as q,h,j as ie,m as _e,o as ee,y as te,z as se,A as ae,p as Oe,q as Ke,k as L,l as N,u as ye,B as le,C as Ue,w as ke}from"../chunks/index.DIjhlOJV.js";import{N as Qe}from"../chunks/Navbar.D4q9cGg9.js";import{g as Ze}from"../chunks/entry.CafXmwvB.js";function he(a){return(a==null?void 0:a.length)!==void 0?a:Array.from(a)}function xe(){let a,e;if(pe.subscribe(t=>a=t),x.subscribe(t=>e=t),!a||!e)throw Xe(307,"/")}const It=Object.freeze(Object.defineProperty({__proto__:null,load:xe},Symbol.toStringTag,{value:"Module"}));function Me(a){let e;return{c(){e=y("i"),this.h()},l(t){e=k(t,"I",{class:!0}),z(e).forEach(_),this.h()},h(){i(e,"class","fa-solid fa-circle-user svelte-qzzk2g")},m(t,s){q(t,e,s)},d(t){t&&_(e)}}}function $e(a){let e,t;return{c(){e=y("img"),this.h()},l(s){e=k(s,"IMG",{class:!0,src:!0,alt:!0}),this.h()},h(){i(e,"class","typeImg svelte-qzzk2g"),ge(e.src,t=a[0].body)||i(e,"src",t),i(e,"alt","Imagen subida Por un usuario")},m(s,l){q(s,e,l)},p(s,l){l&1&&!ge(e.src,t=s[0].body)&&i(e,"src",t)},d(s){s&&_(e)}}}function et(a){let e,t;return{c(){e=y("audio"),this.h()},l(s){e=k(s,"AUDIO",{src:!0}),z(e).forEach(_),this.h()},h(){ge(e.src,t=a[0].body)||i(e,"src",t),e.controls=!0},m(s,l){q(s,e,l)},p(s,l){l&1&&!ge(e.src,t=s[0].body)&&i(e,"src",t)},d(s){s&&_(e)}}}function tt(a){let e,t=a[0].body+"",s;return{c(){e=y("p"),s=Q(t),this.h()},l(l){e=k(l,"P",{class:!0});var r=z(e);s=Z(r,t),r.forEach(_),this.h()},h(){i(e,"class","montserrat-alternates-regular")},m(l,r){q(l,e,r),h(e,s)},p(l,r){r&1&&t!==(t=l[0].body+"")&&ie(s,t)},d(l){l&&_(e)}}}function st(a){let e,t,s,l,r=decodeURI(a[0].username)+"",n,E,c,I,m,g=a[0].type!==a[2].BOT&&Me();function R(d,v){if(d[0].type===d[2].ROOM||d[0].type===d[2].BOT)return tt;if(d[0].type===d[2].AUDIO)return et;if(d[0].type===d[2].IMAGE)return $e}let U=R(a),T=U&&U(a);return{c(){e=y("article"),t=y("div"),g&&g.c(),s=B(),l=y("h4"),n=Q(r),E=B(),c=y("div"),T&&T.c(),this.h()},l(d){e=k(d,"ARTICLE",{class:!0});var v=z(e);t=k(v,"DIV",{class:!0});var f=z(t);g&&g.l(f),s=D(f),l=k(f,"H4",{class:!0});var p=z(l);n=Z(p,r),p.forEach(_),f.forEach(_),E=D(v),c=k(v,"DIV",{class:!0});var O=z(c);T&&T.l(O),O.forEach(_),v.forEach(_),this.h()},h(){i(l,"class","montserrat-alternates-bold svelte-qzzk2g"),i(t,"class","username svelte-qzzk2g"),i(c,"class",I=G(`body ${a[0].type===a[2].BOT?"typeBot":""}`)+" svelte-qzzk2g"),i(e,"class",m=G(a[1].username===decodeURI(a[0].username)?"me":"")+" svelte-qzzk2g")},m(d,v){q(d,e,v),h(e,t),g&&g.m(t,null),h(t,s),h(t,l),h(l,n),h(e,E),h(e,c),T&&T.m(c,null)},p(d,[v]){d[0].type!==d[2].BOT?g||(g=Me(),g.c(),g.m(t,s)):g&&(g.d(1),g=null),v&1&&r!==(r=decodeURI(d[0].username)+"")&&ie(n,r),U===(U=R(d))&&T?T.p(d,v):(T&&T.d(1),T=U&&U(d),T&&(T.c(),T.m(c,null))),v&1&&I!==(I=G(`body ${d[0].type===d[2].BOT?"typeBot":""}`)+" svelte-qzzk2g")&&i(c,"class",I),v&3&&m!==(m=G(d[1].username===decodeURI(d[0].username)?"me":"")+" svelte-qzzk2g")&&i(e,"class",m)},i:P,o:P,d(d){d&&_(e),g&&g.d(),T&&T.d()}}}function at(a,e,t){let s;Y(a,pe,n=>t(1,s=n));var l=(n=>(n.ROOM="room",n.BOT="bot",n.AUDIO="audio",n.IMAGE="image",n.YT="yt",n))(l||{});let{data:r}=e;return a.$$set=n=>{"data"in n&&t(0,r=n.data)},[r,s,l]}class lt extends ne{constructor(e){super(),oe(this,e,at,st,re,{data:0})}}function rt(a){let e,t,s,l,r=decodeURI(a[1].username)+"",n,E,c;return{c(){e=y("article"),t=y("i"),s=B(),l=y("h4"),n=Q(r),E=B(),c=y("i"),this.h()},l(I){e=k(I,"ARTICLE",{"data-id":!0,class:!0});var m=z(e);t=k(m,"I",{class:!0}),z(t).forEach(_),s=D(m),l=k(m,"H4",{class:!0});var g=z(l);n=Z(g,r),g.forEach(_),E=D(m),c=k(m,"I",{class:!0}),z(c).forEach(_),m.forEach(_),this.h()},h(){i(t,"class","fa-solid fa-circle-user svelte-vv2xs7"),i(l,"class","montserrat-alternates-bold svelte-vv2xs7"),i(c,"class","fa-solid fa-circle-question svelte-vv2xs7"),i(e,"data-id",a[0]),i(e,"class","svelte-vv2xs7")},m(I,m){q(I,e,m),h(e,t),h(e,s),h(e,l),h(l,n),h(e,E),h(e,c)},p(I,[m]){m&2&&r!==(r=decodeURI(I[1].username)+"")&&ie(n,r),m&1&&i(e,"data-id",I[0])},i:P,o:P,d(I){I&&_(e)}}}function nt(a,e,t){let{id:s}=e,{data:l}=e;return a.$$set=r=>{"id"in r&&t(0,s=r.id),"data"in r&&t(1,l=r.data)},[s,l]}class ot extends ne{constructor(e){super(),oe(this,e,nt,rt,re,{id:0,data:1})}}function it(a){let e,t,s,l;return{c(){e=y("section"),t=y("article"),s=y("h4"),l=Q(a[0]),this.h()},l(r){e=k(r,"SECTION",{class:!0});var n=z(e);t=k(n,"ARTICLE",{class:!0});var E=z(t);s=k(E,"H4",{class:!0});var c=z(s);l=Z(c,a[0]),c.forEach(_),E.forEach(_),n.forEach(_),this.h()},h(){i(s,"class","montserrat-alternates-medium svelte-1b74fp1"),i(t,"class","svelte-1b74fp1"),i(e,"class","svelte-1b74fp1")},m(r,n){q(r,e,n),h(e,t),h(t,s),h(s,l)},p(r,[n]){n&1&&ie(l,r[0])},i:P,o:P,d(r){r&&_(e)}}}function ct(a,e,t){let s;Y(a,me,n=>t(2,s=n));let{msg:l}=e,{time:r}=e;return Ce(()=>{document.onkeydown=()=>!1}),Ne(()=>{document.onkeydown=null}),setTimeout(()=>$(me,s=!1,s),r),a.$$set=n=>{"msg"in n&&t(0,l=n.msg),"time"in n&&t(1,r=n.time)},[l,r]}class ut extends ne{constructor(e){super(),oe(this,e,ct,it,re,{msg:0,time:1})}}function we(a){let e,t='<i class="fa-solid fa-stop svelte-1in8yok"></i>',s,l;return{c(){e=y("button"),e.innerHTML=t,this.h()},l(r){e=k(r,"BUTTON",{class:!0,"data-svelte-h":!0}),_e(e)!=="svelte-1lqnh5p"&&(e.innerHTML=t),this.h()},h(){i(e,"class","svelte-1in8yok")},m(r,n){q(r,e,n),s||(l=ee(e,"click",a[4]),s=!0)},p:P,d(r){r&&_(e),s=!1,l()}}}function ft(a){let e,t,s='<button class="montserrat-alternates-bold svelte-1in8yok">T</button>',l,r,n,E,c,I='<i class="fa-solid fa-image svelte-1in8yok"></i>',m,g,R,U,T,d,v,f,p=a[0]&&we(a);return{c(){e=y("div"),t=y("div"),t.innerHTML=s,l=B(),r=y("div"),n=y("input"),E=B(),c=y("label"),c.innerHTML=I,m=B(),g=y("div"),R=y("button"),U=y("i"),d=B(),p&&p.c(),this.h()},l(O){e=k(O,"DIV",{class:!0});var A=z(e);t=k(A,"DIV",{class:!0,"data-svelte-h":!0}),_e(t)!=="svelte-j39qlt"&&(t.innerHTML=s),l=D(A),r=k(A,"DIV",{class:!0});var C=z(r);n=k(C,"INPUT",{type:!0,accept:!0,id:!0}),E=D(C),c=k(C,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),_e(c)!=="svelte-dbs90"&&(c.innerHTML=I),C.forEach(_),m=D(A),g=k(A,"DIV",{class:!0});var W=z(g);R=k(W,"BUTTON",{class:!0});var H=z(R);U=k(H,"I",{class:!0}),z(U).forEach(_),H.forEach(_),W.forEach(_),d=D(A),p&&p.l(A),A.forEach(_),this.h()},h(){i(t,"class","txtStyle svelte-1in8yok"),i(n,"type","file"),i(n,"accept","image/*"),n.hidden=!0,i(n,"id","upImg"),i(c,"for","upImg"),i(c,"class","svelte-1in8yok"),i(r,"class","sendImg"),i(U,"class",T=G(`fa-solid fa-microphone ${a[1]}`)+" svelte-1in8yok"),R.disabled=a[2].audioState,i(R,"class","svelte-1in8yok"),i(g,"class","sendAudio"),i(e,"class","tools svelte-1in8yok")},m(O,A){q(O,e,A),h(e,t),h(e,l),h(e,r),h(r,n),h(r,E),h(r,c),h(e,m),h(e,g),h(g,R),h(R,U),h(e,d),p&&p.m(e,null),v||(f=[ee(n,"change",a[5]),ee(R,"click",a[3])],v=!0)},p(O,[A]){A&2&&T!==(T=G(`fa-solid fa-microphone ${O[1]}`)+" svelte-1in8yok")&&i(U,"class",T),O[0]?p?p.p(O,A):(p=we(O),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i:P,o:P,d(O){O&&_(e),p&&p.d(),v=!1,He(f)}}}const Ae="https://frensgo.lat";function dt(a,e,t){var U,Pe;let s;Y(a,pe,d=>t(8,s=d));let{cbAudio:l}=e,{cbImage:r}=e;class n{constructor(){Re(this,U);j(this,"constraints");j(this,"chunks");j(this,"mediaRecorder");j(this,"audioURL");j(this,"audioState",!0);j(this,"state");j(this,"timeOut");navigator.mediaDevices&&(this.constraints={audio:!0},this.chunks=[],this.audioState=!1)}getDevices(){navigator.mediaDevices.getUserMedia(this.constraints).then(v=>{this.mediaRecorder=new MediaRecorder(v),this.mediaRecorder.ondataavailable=f=>{this.chunks.push(f.data)},this.mediaRecorder.onstop=async f=>{if(!this.state){this.chunks=[];return}const p=new Blob(this.chunks,{type:"audio/ogg;codecs=opus"});this.chunks=[];const O=await ze(this,U,Pe).call(this,p);l({username:s.username,body:O,type:"audio"})}})}start(){return this.mediaRecorder&&(this.mediaRecorder.state==="inactive"||this.mediaRecorder.state==="paused")?(this.mediaRecorder.start(),this.timeOut=setTimeout(()=>{var v;return(v=this.mediaRecorder)==null?void 0:v.stop()},18e4),!0):!1}stop(v){return this.mediaRecorder&&this.mediaRecorder.state==="recording"?(clearTimeout(this.timeOut),this.state=v,this.mediaRecorder.stop(),!1):!0}}U=new WeakSet,Pe=async function(v){const f=new FormData;return f.append("audio",v),await(await fetch(`${Ae}/audio`,{method:"POST",body:f})).text()};const E=new n;E.getDevices();let c=!1,I="stop";function m(){c?(t(0,c=E.stop(!0)),t(1,I="stop")):(t(0,c=E.start()),t(1,I="rec"))}function g(){t(0,c=E.stop(!1)),t(1,I="stop")}async function R(d){const v=d.target.files[0];if(v.size>5e6){alert("La imágen es muy pesada");return}if(!/^image\/....?$/.test(v.type)){alert("Por favor elija una imágen válida");return}const f=new FormData;f.append("image",v);const O=await(await fetch(`${Ae}/upImg`,{method:"POST",body:f})).text();r({username:s.username,body:O,type:"image"})}return a.$$set=d=>{"cbAudio"in d&&t(6,l=d.cbAudio),"cbImage"in d&&t(7,r=d.cbImage)},[c,I,E,m,g,R,l,r]}class ht extends ne{constructor(e){super(),oe(this,e,dt,ft,re,{cbAudio:6,cbImage:7})}}function Se(a,e,t){const s=a.slice();return s[15]=e[t][0],s[16]=e[t][1],s}function Be(a,e,t){const s=a.slice();return s[19]=e[t],s}function De(a){let e,t;return e=new ut({props:{msg:"Aver si nos calmamos un poquito :)",time:5e3}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Le(a){let e,t;return e=new lt({props:{data:a[19]}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},p(s,l){const r={};l&8&&(r.data=s[19]),e.$set(r)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function qe(a){let e,t;return e=new ot({props:{id:a[15],data:a[16]}}),{c(){te(e.$$.fragment)},l(s){se(e.$$.fragment,s)},m(s,l){ae(e,s,l),t=!0},p(s,l){const r={};l&4&&(r.id=s[15]),l&4&&(r.data=s[16]),e.$set(r)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){N(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function mt(a){let e,t,s,l,r,n,E,c,I,m,g,R,U,T,d='<i class="fa-solid fa-paper-plane svelte-8zx99x"></i>',v,f,p,O,A=a[2].size+"",C,W,H,ce,K,ve,Ee,S=a[4]&&De();t=new Qe({});let F=he(a[3]),M=[];for(let o=0;o<F.length;o+=1)M[o]=Le(Be(a,F,o));const Ve=o=>N(M[o],1,1,()=>{M[o]=null});I=new ht({props:{cbAudio:a[6],cbImage:a[7]}});let J=he(a[2].entries()),w=[];for(let o=0;o<J.length;o+=1)w[o]=qe(Se(a,J,o));const je=o=>N(w[o],1,1,()=>{w[o]=null});return{c(){S&&S.c(),e=B(),te(t.$$.fragment),s=B(),l=y("section"),r=y("article"),n=y("div");for(let o=0;o<M.length;o+=1)M[o].c();E=B(),c=y("div"),te(I.$$.fragment),m=B(),g=y("form"),R=y("input"),U=B(),T=y("button"),T.innerHTML=d,v=B(),f=y("article"),p=y("h3"),O=Q("Usuarios conectados: "),C=Q(A),W=B(),H=y("div");for(let o=0;o<w.length;o+=1)w[o].c();this.h()},l(o){S&&S.l(o),e=D(o),se(t.$$.fragment,o),s=D(o),l=k(o,"SECTION",{class:!0});var b=z(l);r=k(b,"ARTICLE",{class:!0});var u=z(r);n=k(u,"DIV",{class:!0});var V=z(n);for(let X=0;X<M.length;X+=1)M[X].l(V);V.forEach(_),E=D(u),c=k(u,"DIV",{class:!0});var ue=z(c);se(I.$$.fragment,ue),m=D(ue),g=k(ue,"FORM",{class:!0});var fe=z(g);R=k(fe,"INPUT",{class:!0,type:!0,placeholder:!0,maxlength:!0,minlength:!0}),U=D(fe),T=k(fe,"BUTTON",{class:!0,"data-svelte-h":!0}),_e(T)!=="svelte-1m1u804"&&(T.innerHTML=d),fe.forEach(_),ue.forEach(_),u.forEach(_),v=D(b),f=k(b,"ARTICLE",{class:!0});var de=z(f);p=k(de,"H3",{class:!0});var be=z(p);O=Z(be,"Usuarios conectados: "),C=Z(be,A),be.forEach(_),W=D(de),H=k(de,"DIV",{class:!0});var Ie=z(H);for(let X=0;X<w.length;X+=1)w[X].l(Ie);Ie.forEach(_),de.forEach(_),b.forEach(_),this.h()},h(){i(n,"class","chat svelte-8zx99x"),i(R,"class","montserrat-alternates-regular svelte-8zx99x"),i(R,"type","text"),i(R,"placeholder","Escribe tu mensaje..."),i(R,"maxlength","120"),i(R,"minlength","1"),i(T,"class","svelte-8zx99x"),i(g,"class","svelte-8zx99x"),i(c,"class","msg svelte-8zx99x"),i(r,"class","chatBX svelte-8zx99x"),i(p,"class","montserrat-alternates-bold svelte-8zx99x"),i(H,"class","userlist svelte-8zx99x"),i(f,"class",ce=G(`users ${a[5]?"showUserlist":""}`)+" svelte-8zx99x"),i(l,"class","svelte-8zx99x")},m(o,b){S&&S.m(o,b),q(o,e,b),ae(t,o,b),q(o,s,b),q(o,l,b),h(l,r),h(r,n);for(let u=0;u<M.length;u+=1)M[u]&&M[u].m(n,null);a[9](n),h(r,E),h(r,c),ae(I,c,null),h(c,m),h(c,g),h(g,R),Oe(R,a[0]),h(g,U),h(g,T),h(l,v),h(l,f),h(f,p),h(p,O),h(p,C),h(f,W),h(f,H);for(let u=0;u<w.length;u+=1)w[u]&&w[u].m(H,null);K=!0,ve||(Ee=[ee(R,"input",a[10]),ee(g,"submit",Ke(a[8]))],ve=!0)},p(o,[b]){if(o[4]?S?b&16&&L(S,1):(S=De(),S.c(),L(S,1),S.m(e.parentNode,e)):S&&(ke(),N(S,1,1,()=>{S=null}),ye()),b&8){F=he(o[3]);let u;for(u=0;u<F.length;u+=1){const V=Be(o,F,u);M[u]?(M[u].p(V,b),L(M[u],1)):(M[u]=Le(V),M[u].c(),L(M[u],1),M[u].m(n,null))}for(ke(),u=F.length;u<M.length;u+=1)Ve(u);ye()}if(b&1&&R.value!==o[0]&&Oe(R,o[0]),(!K||b&4)&&A!==(A=o[2].size+"")&&ie(C,A),b&4){J=he(o[2].entries());let u;for(u=0;u<J.length;u+=1){const V=Se(o,J,u);w[u]?(w[u].p(V,b),L(w[u],1)):(w[u]=qe(V),w[u].c(),L(w[u],1),w[u].m(H,null))}for(ke(),u=J.length;u<w.length;u+=1)je(u);ye()}(!K||b&32&&ce!==(ce=G(`users ${o[5]?"showUserlist":""}`)+" svelte-8zx99x"))&&i(f,"class",ce)},i(o){if(!K){L(S),L(t.$$.fragment,o);for(let b=0;b<F.length;b+=1)L(M[b]);L(I.$$.fragment,o);for(let b=0;b<J.length;b+=1)L(w[b]);K=!0}},o(o){N(S),N(t.$$.fragment,o),M=M.filter(Boolean);for(let b=0;b<M.length;b+=1)N(M[b]);N(I.$$.fragment,o),w=w.filter(Boolean);for(let b=0;b<w.length;b+=1)N(w[b]);K=!1},d(o){o&&(_(e),_(s),_(l)),S&&S.d(o),le(t,o),Ue(M,o),a[9](null),le(I),Ue(w,o),ve=!1,He(Ee)}}}function gt(a){a.scroll({top:a.scrollHeight,behavior:"smooth"})}function _t(a,e,t){let s,l,r,n;Y(a,x,f=>t(11,s=f)),Y(a,me,f=>t(4,l=f)),Y(a,pe,f=>t(12,r=f)),Y(a,Ye,f=>t(5,n=f));let E="",c=null,I=[],m=[{username:"frensgo :",body:`Bienvenido a la sala ${r.room}`,type:"bot"}];function g(f){m.push(f),t(3,m)}function R(f){m.push(f),t(3,m)}Ce(()=>{s.send(JSON.stringify({type:"GETUSERLIST"}))}),Ne(()=>{s.close(),$(x,s=null,s)});function U(f,p){switch(f){case"USERLIST":const O=new Map(p);t(2,I=O);break;case"NEW_USER":const A={username:"frensgo :",body:p,type:"bot"};m.push(A),t(3,m);break;case"BYE_USER":const C={username:"frensgo :",body:p,type:"bot"};m.push(C),t(3,m);break;case"ROOM_MSG":m.push({...p,type:"room"}),t(3,m),m.length>=30&&(m.shift(),t(3,m)),setTimeout(()=>gt(c),.1);break;case"CALM":$(me,l=!0,l)}}$(x,s.onmessage=f=>{const{type:p,msg:O}=JSON.parse(f.data);U(p,O)},s),$(x,s.onclose=()=>{Ze("/rooms")},s);function T(){!E||E.length===0||E.length>120||(s.send(JSON.stringify({type:"ROOM_MSG",msg:E.trim()})),t(0,E=""))}function d(f){We[f?"unshift":"push"](()=>{c=f,t(1,c)})}function v(){E=this.value,t(0,E)}return[E,c,I,m,l,n,g,R,T,d,v]}class Tt extends ne{constructor(e){super(),oe(this,e,_t,mt,re,{})}}export{Tt as component,It as universal};
